<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Supporting HTTP/3 at the ingress gateway in Istio - Tech notes</title>
<meta name=description content="Contents  Introduction Prerequistes  Kubernetes cURL Istio   Setup  Setting up Istio Deploying httpbin Setting up TLS certificates for the gateway Istio configuration   Demo time    Introduction A few months ago I contributed experimental HTTP/3 support at the Istio ingress gateway (PR). For the HTTPS gateway servers which terminate the TLS at the gateway, it automatically adds a mirror HTTP/3 listener over QUIC provided that there is an open UDP port.">
<meta name=author content="Suchith J N"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Tech notes","url":"https:\/\/su225.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/su225.github.io\/"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/su225.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/su225.github.io\/posts\/http3-support-in-istio-gateway\/","name":"Supporting HTTP 3 at the ingress gateway in istio"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Suchith J N"},"headline":"Supporting HTTP\/3 at the ingress gateway in Istio","description":"Contents  Introduction Prerequistes  Kubernetes cURL Istio   Setup  Setting up Istio Deploying httpbin Setting up TLS certificates for the gateway Istio configuration   Demo time    Introduction A few months ago I contributed experimental HTTP\/3 support at the Istio ingress gateway (PR). For the HTTPS gateway servers which terminate the TLS at the gateway, it automatically adds a mirror HTTP\/3 listener over QUIC provided that there is an open UDP port.","inLanguage":"en","wordCount":1719,"datePublished":"2021-10-23T20:00:17","dateModified":"2021-10-23T20:00:17","image":"https:\/\/su225.github.io\/","keywords":["istio, quic"],"mainEntityOfPage":"https:\/\/su225.github.io\/posts\/http3-support-in-istio-gateway\/","publisher":{"@type":"Organization","name":"https:\/\/su225.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/su225.github.io\/","height":60,"width":60}}}</script>
<meta property="og:title" content="Supporting HTTP/3 at the ingress gateway in Istio">
<meta property="og:description" content="Contents  Introduction Prerequistes  Kubernetes cURL Istio   Setup  Setting up Istio Deploying httpbin Setting up TLS certificates for the gateway Istio configuration   Demo time    Introduction A few months ago I contributed experimental HTTP/3 support at the Istio ingress gateway (PR). For the HTTPS gateway servers which terminate the TLS at the gateway, it automatically adds a mirror HTTP/3 listener over QUIC provided that there is an open UDP port.">
<meta property="og:url" content="https://su225.github.io/posts/http3-support-in-istio-gateway/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Tech notes">
<meta name=twitter:title content="Supporting HTTP/3 at the ingress gateway in Istio">
<meta name=twitter:description content="Contents  Introduction Prerequistes  Kubernetes cURL Istio   Setup  Setting up Istio Deploying httpbin Setting up TLS certificates for the gateway Istio configuration   Demo time    Introduction A few â€¦">
<meta name=twitter:card content="summary">
<meta name=generator content="Hugo 0.91.0">
<link rel=alternate href=https://su225.github.io/index.xml type=application/rss+xml title="Tech notes"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://su225.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://su225.github.io/css/syntax.css><link rel=stylesheet href=https://su225.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://su225.github.io/>Tech notes</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=/>Blog</a>
</li>
<li>
<a title=About href=/about>About</a>
</li>
</ul>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=posts-heading>
<h1>Supporting HTTP/3 at the ingress gateway in Istio</h1>
<hr class=small>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<div class=toc>
<h2>Contents</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#prerequistes>Prerequistes</a>
<ul>
<li><a href=#kubernetes>Kubernetes</a></li>
<li><a href=#curl>cURL</a></li>
<li><a href=#istio>Istio</a></li>
</ul>
</li>
<li><a href=#setup>Setup</a>
<ul>
<li><a href=#setting-up-istio>Setting up Istio</a></li>
<li><a href=#deploying-httpbin>Deploying httpbin</a></li>
<li><a href=#setting-up-tls-certificates-for-the-gateway>Setting up TLS certificates for the gateway</a></li>
<li><a href=#istio-configuration>Istio configuration</a></li>
</ul>
</li>
<li><a href=#demo-time>Demo time</a></li>
</ul>
</nav>
</div>
<h2 id=introduction>Introduction</h2>
<p>A few months ago I contributed experimental HTTP/3 support at the Istio ingress gateway
(<a href=https://github.com/istio/istio/pull/33817>PR</a>). For the HTTPS gateway
servers which terminate the TLS at the gateway, it automatically adds a mirror HTTP/3
listener over QUIC provided that there is an open UDP port. If there is an HTTPS server
on TCP port 443, then an HTTP/3 server is automatically created on UDP port 443 as
illustrated in the diagram below. All you need to do is to flip a switch on pilot and
open UDP ports.</p>
<link href=/css/mermaid.css type=text/css rel=stylesheet>
<script defer src=/js/mermaid.js>mermaid.initialize({startOnLoad:!0})</script>
<div class=mermaid align=center>
graph LR
client((HTTP client))
subgraph cluster
subgraph istio-ingressgateway
tcpPort("443/TCP - HTTP/2 over TCP")
udpPort("443/UDP - HTTP/3 over QUIC")
end
subgraph httpbin
httpbinTcpPort(8000/TCP)
end
tcpPort --> httpbinTcpPort
udpPort --> httpbinTcpPort
style tcpPort fill:gold
style udpPort fill:yellow
end
client --> tcpPort
client --> udpPort
</div>
<h2 id=prerequistes>Prerequistes</h2>
<p>HTTP/3 over QUIC is so new as of writing this. QUIC was standardized this May end and HTTP/3 is not yet
standardized (There is an IETF draft <a href=https://datatracker.ietf.org/doc/html/draft-ietf-quic-http-34>here</a>).
So creating custom builds, turning on alpha features are expected. I&rsquo;m running Linux.</p>
<h3 id=kubernetes>Kubernetes</h3>
<p>This feature requires the supporting both TCP and UDP on the same port at the gateway. By
default for Kubernetes services of type <code>LoadBalancer</code> this is not allowed. Since Kubernetes
1.20 there is alpha support. As documented <a href=https://kubernetes.io/docs/concepts/services-networking/service/#load-balancers-with-mixed-protocol-types>here</a>, it can be turned on with <code>MixedProtocolLBSupport</code>
feature gate.</p>
<p>For this demo, I use Kind to provision a cluster with the following config
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>kind</span>: Cluster
<span style=color:#ff79c6>apiVersion</span>: kind.x-k8s.io/v1alpha4
<span style=color:#ff79c6>featureGates</span>:
<span style=display:block;width:100%;background-color:#3d3f4a>  <span style=color:#ff79c6>MixedProtocolLBService</span>: <span style=color:#ff79c6>true</span> <span style=color:#6272a4># Very important</span>
</span><span style=color:#ff79c6>kubeadmConfigPatches</span>:
- |<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>  apiVersion: kubeadm.k8s.io/v1beta2
</span><span style=color:#f1fa8c>  kind: ClusterConfiguration
</span><span style=color:#f1fa8c>  metadata:
</span><span style=color:#f1fa8c>    name: config
</span><span style=color:#f1fa8c>  apiServer:
</span><span style=color:#f1fa8c>    extraArgs:
</span><span style=color:#f1fa8c>      &#34;service-account-issuer&#34;: &#34;kubernetes.default.svc&#34;
</span><span style=color:#f1fa8c>      &#34;service-account-signing-key-file&#34;: &#34;/etc/kubernetes/pki/sa.key&#34;</span>  
<span style=color:#ff79c6>containerdConfigPatches</span>:
  - |-<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;localhost:5000&#34;]
</span><span style=color:#f1fa8c>      endpoint = [&#34;http://kind-registry:5000&#34;]</span>    </code></pre></td></tr></table>
</div>
</div></p>
<p>For the load balancer support, I&rsquo;m using <a href=https://metallb.universe.tf/>MetalLB</a> with the following configuration.
For setup and usage instructions, please refer to their documentation.</p>
<h3 id=curl>cURL</h3>
<p>Testing the setup requires support for <code>--http3</code> flag. If it is not supported out of the box,
then you have to build it with Cloudflare Quiche support as documented <a href=https://github.com/curl/curl/blob/master/docs/HTTP3.md>here</a>.</p>
<h3 id=istio>Istio</h3>
<p>As of writing this Istio 1.12 is not yet released. So the pilot and proxy images should be
built from the master branch.</p>
<h2 id=setup>Setup</h2>
<p>Demo setup consists of</p>
<ol>
<li>Setting up Istio</li>
<li>Deploying httpbin application</li>
<li>Setting up gateway TLS certificates</li>
<li>Configuring ingress gateway</li>
</ol>
<h3 id=setting-up-istio>Setting up Istio</h3>
<p>There are two important things</p>
<ol>
<li>Set <code>PILOT_ENABLE_QUIC_LISTENERS</code> environment variable to <code>true</code> on <strong>Istiod</strong> to turn on generating HTTP/3 mirror listener on the gateway</li>
<li>Exposing both 443/UDP and 443/TCP - <strong>same port, different transport protocol</strong></li>
</ol>
<p>Here is an example <code>IstioOperator</code> spec.
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span></span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: install.istio.io/v1alpha1
<span style=color:#ff79c6>kind</span>: IstioOperator
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: install
<span style=color:#ff79c6>spec</span>:
  <span style=color:#6272a4># Replace HUB and TAG to point to your</span>
  <span style=color:#6272a4># image repository and the custom image tag</span>
  <span style=color:#ff79c6>hub</span>: localhost:5000
  <span style=color:#ff79c6>tag</span>: master
  <span style=color:#ff79c6>components</span>:
    <span style=color:#ff79c6>ingressGateways</span>:
    - <span style=color:#ff79c6>name</span>: istio-ingressgateway
      <span style=color:#ff79c6>enabled</span>: <span style=color:#ff79c6>true</span>
      <span style=color:#ff79c6>k8s</span>:
        <span style=color:#ff79c6>service</span>:
          <span style=color:#ff79c6>ports</span>:
          - <span style=color:#ff79c6>name</span>: status-port
            <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>15021</span>
            <span style=color:#ff79c6>targetPort</span>: <span style=color:#bd93f9>15021</span>
          <span style=color:#6272a4># Both HTTPS and HTTP/3 must have</span>
          <span style=color:#6272a4># the same port number. Here it</span>
          <span style=color:#6272a4># is 443/TCP and 443/UDP</span>
<span style=display:block;width:100%;background-color:#3d3f4a>          - <span style=color:#ff79c6>name</span>: https
</span><span style=display:block;width:100%;background-color:#3d3f4a>            <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>443</span>
</span><span style=display:block;width:100%;background-color:#3d3f4a>            <span style=color:#ff79c6>targetPort</span>: <span style=color:#bd93f9>8443</span>
</span><span style=display:block;width:100%;background-color:#3d3f4a>          - <span style=color:#ff79c6>name</span>: http3
</span><span style=display:block;width:100%;background-color:#3d3f4a>            <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>443</span>
</span><span style=display:block;width:100%;background-color:#3d3f4a>            <span style=color:#ff79c6>targetPort</span>: <span style=color:#bd93f9>8443</span>
</span><span style=display:block;width:100%;background-color:#3d3f4a>            <span style=color:#ff79c6>protocol</span>: UDP
</span>  <span style=color:#ff79c6>values</span>:
    <span style=color:#ff79c6>pilot</span>:
      <span style=color:#6272a4># This is required to create mirror QUIC</span>
      <span style=color:#6272a4># listeners for TLS-terminated HTTPS listeners</span>
      <span style=color:#6272a4># on the gateway</span>
      <span style=color:#ff79c6>env</span>:
<span style=display:block;width:100%;background-color:#3d3f4a>        <span style=color:#ff79c6>PILOT_ENABLE_QUIC_LISTENERS</span>: <span style=color:#ff79c6>true</span></span></code></pre></td></tr></table>
</div>
</div>
Then install Istio
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ istioctl install -f istio.yaml -y</code></pre></td></tr></table>
</div>
</div></p>
<h3 id=deploying-httpbin>Deploying httpbin</h3>
<p>I am using the sample httpbin provided in the main Istio repository (<a href=https://raw.githubusercontent.com/istio/istio/master/samples/httpbin/httpbin.yaml>Link</a>). Deploy it with good old <code>kubectl</code>. Make sure that Istio sidecars are injected.
You can turn on istio sidecar injection at the namespace level by labeling it <code>istio-injection=enabled</code>
or if you are using revisions (please use it to make upgrades smoother), then it is <code>istio.io/rev=&lt;revision-name></code>.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create namespace httpbin
$ kubectl label namespace httpbin istio-injection<span style=color:#ff79c6>=</span>enabled
$ kubectl -n httpbin apply -f <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  https://raw.githubusercontent.com/istio/istio/master/samples/httpbin/httpbin.yaml</code></pre></td></tr></table>
</div>
</div>
<h3 id=setting-up-tls-certificates-for-the-gateway>Setting up TLS certificates for the gateway</h3>
<p>HTTP/3 is over TLS only. In fact, using TLS is baked into QUIC, the underlying transport protocol
as described in <a href=https://datatracker.ietf.org/doc/html/rfc9000>RFC-9000</a> and <a href=https://datatracker.ietf.org/doc/html/rfc9001>RFC-9001</a>.
So we need to generate and install certificates. For the demo, I&rsquo;m using self-signed certificates.</p>
<ol>
<li>
<p>Parameters for the certificate (Like SAN). Save it as <code>httpbin.cfg</code>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cfg data-lang=cfg><span style=color:#ff79c6>[req]</span>
<span style=color:#50fa7b>default_bits</span>       <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>2048</span>
<span style=color:#50fa7b>prompt</span>             <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>no</span>
<span style=color:#50fa7b>distinguished_name</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>req_distinguished_name</span>
<span style=color:#50fa7b>req_extensions</span>     <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>san_reqext</span>

<span style=color:#ff79c6>[ req_distinguished_name ]</span>
<span style=color:#50fa7b>countryName</span>         <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>XX</span>
<span style=color:#50fa7b>stateOrProvinceName</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>YY</span>
<span style=color:#50fa7b>organizationName</span>    <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>QuicCorp</span>

<span style=color:#ff79c6>[ san_reqext ]</span>
<span style=color:#50fa7b>subjectAltName</span>      <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>@alt_names</span>

<span style=color:#ff79c6>[alt_names]</span>
<span style=color:#50fa7b>DNS.0</span>   <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>httpbin.quic-corp.com</span></code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p>Generate TLS certificates and keys with the following script. Here, I&rsquo;m using <code>openssl</code>. You can
use other tools like <code>cfssl</code> as well.
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7>7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8>8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9>9</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>openssl req -x509 -sha256 -nodes -days <span style=color:#bd93f9>365</span> -newkey rsa:4096 -subj <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    <span style=color:#f1fa8c>&#34;/C=XX/ST=YY/O=QuicCorp&#34;</span> -keyout quiccorp-ca.key -out quiccorp-ca.crt

openssl req -out httpbin.csr -newkey rsa:2048 -nodes <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    -keyout httpbin.key -config httpbin.cnf

openssl x509 -req -days <span style=color:#bd93f9>365</span> -CA quiccorp-ca.crt -CAkey quiccorp-ca.key <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    -set_serial <span style=color:#bd93f9>0</span> -in httpbin.csr -out httpbin.crt <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    -extfile httpbin.cnf -extensions san_reqext</code></pre></td></tr></table>
</div>
</div></p>
</li>
<li>
<p>Install the certificates
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl -n istio-system create secret tls httpbin-cred <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --key<span style=color:#ff79c6>=</span>httpbin.key --cert<span style=color:#ff79c6>=</span>httpbin.crt</code></pre></td></tr></table>
</div>
</div></p>
</li>
</ol>
<h3 id=istio-configuration>Istio configuration</h3>
<p>Remember, HTTP/3 listener is generated <strong>automatically</strong> for TLS-terminated HTTPS listener. Currently,
specifying that a port is HTTP/3-only is not yet supported. This is because HTTP/3 support is not widespread
yet and the most common use case is for the clients like Google Chrome to become aware of HTTP/3 support
with <code>alt-svc</code> HTTP header in the response when they first use HTTP/1.1 or HTTP/2 over TCP.</p>
<p>Configure the gateway. Notice that there is no explicit HTTP/3 related configuration
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: networking.istio.io/v1beta1
<span style=color:#ff79c6>kind</span>: Gateway
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: httpbin-gateway
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>selector</span>:
    <span style=color:#ff79c6>app</span>: istio-ingressgateway
    <span style=color:#ff79c6>istio</span>: ingressgateway
  <span style=color:#ff79c6>servers</span>:
  - <span style=color:#ff79c6>port</span>:
      <span style=color:#ff79c6>number</span>: <span style=color:#bd93f9>443</span>
      <span style=color:#ff79c6>name</span>: https
      <span style=color:#ff79c6>protocol</span>: HTTPS
    <span style=color:#ff79c6>hosts</span>:
    - httpbin.quic-corp.com
    <span style=color:#ff79c6>tls</span>:
      <span style=color:#ff79c6>mode</span>: SIMPLE
      <span style=color:#ff79c6>credentialName</span>: httpbin-cred</code></pre></td></tr></table>
</div>
</div></p>
<p>Configure the route
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: networking.istio.io/v1beta1
<span style=color:#ff79c6>kind</span>: VirtualService
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: httpbin-route
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>hosts</span>:
  - httpbin.quic-corp.com
  <span style=color:#ff79c6>gateways</span>:
  - httpbin-gateway
  <span style=color:#ff79c6>http</span>:
  - <span style=color:#ff79c6>name</span>: httpbin-default-route
    <span style=color:#ff79c6>route</span>:
    - <span style=color:#ff79c6>destination</span>:
        <span style=color:#ff79c6>host</span>: httpbin.httpbin.svc.cluster.local
        <span style=color:#ff79c6>port</span>: 
          <span style=color:#ff79c6>number</span>: <span style=color:#bd93f9>8000</span></code></pre></td></tr></table>
</div>
</div></p>
<p>Once these routes are applied, check if two listeners are created
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ istioctl proxy-config listeners istio-ingressgateway-6fdcddbb8b-9rpkx.istio-system
ADDRESS PORT  MATCH                      DESTINATION
<span style=display:block;width:100%;background-color:#3d3f4a>0.0.0.0 <span style=color:#bd93f9>8443</span>  SNI: httpbin.quic-corp.com Route: https.443.https.httpbin-gateway.istio-system
</span><span style=display:block;width:100%;background-color:#3d3f4a>0.0.0.0 <span style=color:#bd93f9>8443</span>  SNI: httpbin.quic-corp.com Route: https.443.https.httpbin-gateway.istio-system
</span>0.0.0.0 <span style=color:#bd93f9>15021</span> ALL                        Inline Route: /healthz/ready*
0.0.0.0 <span style=color:#bd93f9>15090</span> ALL                        Inline Route: /stats/prometheus*</code></pre></td></tr></table>
</div>
</div>
Where did the other inbound listener come from? Let us dive deeper into the config.
Let us start with checking listener names
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span></span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ istioctl proxy-config listeners istio-ingressgateway-6fdcddbb8b-9rpkx.istio-system <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --address 0.0.0.0 --port <span style=color:#bd93f9>8443</span> -o json | jq -r <span style=color:#f1fa8c>&#39;.[].name&#39;</span>
0.0.0.0_8443
<span style=display:block;width:100%;background-color:#3d3f4a>udp_0.0.0.0_8443</span></code></pre></td></tr></table>
</div>
</div>
UDP?? Remember that QUIC uses UDP. So could this be related to QUIC? Let us dive deeper.
The output is huge and only the relevant part is shown here. So pipe it to a pager like <code>less</code>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#ff79c6>&#34;transportSocket&#34;</span>: {
<span style=display:block;width:100%;background-color:#3d3f4a>      <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;envoy.transport_sockets.quic&#34;</span>,
</span><span style=display:block;width:100%;background-color:#3d3f4a>      <span style=color:#ff79c6>&#34;typedConfig&#34;</span>: {
</span><span style=display:block;width:100%;background-color:#3d3f4a>          <span style=color:#ff79c6>&#34;@type&#34;</span>: <span style=color:#f1fa8c>&#34;type.googleapis.com/envoy.extensions.transport_sockets.quic.v3.QuicDownstreamTransport&#34;</span>,
</span>          <span style=color:#ff79c6>&#34;downstreamTlsContext&#34;</span>: {
              <span style=color:#ff79c6>&#34;commonTlsContext&#34;</span>: {
                  <span style=color:#ff79c6>&#34;tlsCertificateSdsSecretConfigs&#34;</span>: [
                      {
                          <span style=color:#ff79c6>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;kubernetes://httpbin-cred&#34;</span>,
                          <span style=color:#ff79c6>&#34;sdsConfig&#34;</span>: {
                              <span style=color:#ff79c6>&#34;ads&#34;</span>: {},
                              <span style=color:#ff79c6>&#34;resourceApiVersion&#34;</span>: <span style=color:#f1fa8c>&#34;V3&#34;</span>
                          }
                      }
                  ],
                  <span style=color:#ff79c6>&#34;alpnProtocols&#34;</span>: [
                      <span style=color:#f1fa8c>&#34;h3&#34;</span>
                  ]
              },
              <span style=color:#ff79c6>&#34;requireClientCertificate&#34;</span>: <span style=color:#ff79c6>false</span>
          }
      }
  }
}</code></pre></td></tr></table>
</div>
</div>
Well&mldr;The one with <code>udp</code> prefix is a QUIC listener!</p>
<h2 id=demo-time>Demo time</h2>
<p>First note down the address of the Ingress gateway
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl -n istio-system get svc
NAME                   TYPE           CLUSTER-IP      EXTERNAL-IP    PORT<span style=color:#ff79c6>(</span>S<span style=color:#ff79c6>)</span>                                       AGE
istio-ingressgateway   LoadBalancer   10.96.112.53    172.18.200.1   15021:32534/TCP,443:31597/TCP,443:31597/UDP   79m
istiod                 ClusterIP      10.96.255.123   &lt;none&gt;         15010/TCP,15012/TCP,443/TCP,15014/TCP         79m

$ <span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>INGRESS_IP</span><span style=color:#ff79c6>=</span>172.18.200.1</code></pre></td></tr></table>
</div>
</div></p>
<p>I have a custom build of curl called <code>qcurl</code> which supports sending HTTP/3 request with
<code>--http3</code> flag. <code>curl</code> here is the standard curl available in the software repositories.
For demo purposes, I&rsquo;m skipping TLS certificate verification. Don&rsquo;t this if it is not a demo.</p>
<p>Let us first send HTTP/2 request
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -svk --http2 --resolve httpbin.quic-corp.com:443:<span style=color:#8be9fd;font-style:italic>$INGRESS_IP</span> https://httpbin.quic-corp.com/headers
<span style=color:#ff79c6>[</span> Output truncated <span style=color:#ff79c6>]</span>
...
&gt; GET /headers HTTP/2
&gt; Host: httpbin.quic-corp.com
&gt; user-agent: curl/7.76.1
&gt; accept: */*
...
<span style=display:block;width:100%;background-color:#3d3f4a>&lt; HTTP/2 <span style=color:#bd93f9>200</span> 
</span>&lt; server: istio-envoy
&lt; date: Wed, <span style=color:#bd93f9>27</span> Oct <span style=color:#bd93f9>2021</span> 05:05:59 GMT
&lt; content-type: application/json
&lt; content-length: <span style=color:#bd93f9>601</span>
&lt; access-control-allow-origin: *
&lt; access-control-allow-credentials: <span style=color:#8be9fd;font-style:italic>true</span>
&lt; x-envoy-upstream-service-time: <span style=color:#bd93f9>1</span>
<span style=display:block;width:100%;background-color:#3d3f4a>&lt; alt-svc: <span style=color:#8be9fd;font-style:italic>h3</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;:443&#34;</span>; <span style=color:#8be9fd;font-style:italic>ma</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>86400</span>
</span>&lt; 
<span style=color:#ff79c6>{</span>
  <span style=color:#f1fa8c>&#34;headers&#34;</span>: <span style=color:#ff79c6>{</span>
    <span style=color:#f1fa8c>&#34;Accept&#34;</span>: <span style=color:#f1fa8c>&#34;*/*&#34;</span>, 
    <span style=color:#f1fa8c>&#34;Host&#34;</span>: <span style=color:#f1fa8c>&#34;httpbin.quic-corp.com&#34;</span>, 
    <span style=color:#f1fa8c>&#34;User-Agent&#34;</span>: <span style=color:#f1fa8c>&#34;curl/7.76.1&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Parentspanid&#34;</span>: <span style=color:#f1fa8c>&#34;819c2b2cab59bbe8&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Sampled&#34;</span>: <span style=color:#f1fa8c>&#34;0&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Spanid&#34;</span>: <span style=color:#f1fa8c>&#34;0462ac631afb5f84&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Traceid&#34;</span>: <span style=color:#f1fa8c>&#34;3fa44e3bbbcd21a3819c2b2cab59bbe8&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Envoy-Attempt-Count&#34;</span>: <span style=color:#f1fa8c>&#34;1&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Envoy-Internal&#34;</span>: <span style=color:#f1fa8c>&#34;true&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Forwarded-Client-Cert&#34;</span>: <span style=color:#f1fa8c>&#34;By=spiffe://cluster.local/ns/httpbin/sa/httpbin;Hash=97bf9c90d4a5b9bb8f5da3e825dfa34f04631400420649394741807a320aa0a1;Subject=\&#34;\&#34;;URI=spiffe://cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account&#34;</span>
  <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span></code></pre></td></tr></table>
</div>
</div>
Yayyy! It is working. In particular notice this header
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>alt-svc: <span style=color:#8be9fd;font-style:italic>h3</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;:443&#34;</span>; <span style=color:#8be9fd;font-style:italic>ma</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>86400</span></code></pre></td></tr></table>
</div>
</div>
It indicates that HTTP/3 is supported. <code>h3</code> is the ALPN sent with the TLS handshake.
Clients supporting HTTP/3 can use this information to connect with QUIC for the future
connections. <strong>Now, let us send an HTTP/3 request</strong>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span></span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style=display:block;width:100%;background-color:#3d3f4a><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42>42</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43>43</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44><a style=outline:none;text-decoration:none;color:inherit href=#44>44</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ qcurl -svk --http3 --resolve httpbin.quic-corp.com:443:<span style=color:#8be9fd;font-style:italic>$INGRESS_IP</span> https://httpbin.quic-corp.com/headers
* Added httpbin.quic-corp.com:443:172.18.200.1 to DNS cache
* Hostname httpbin.quic-corp.com was found in DNS cache
*   Trying 172.18.200.1:443...
* Connect socket <span style=color:#bd93f9>5</span> over QUIC to 172.18.200.1:443
* Sent QUIC client Initial, ALPN: h3,h3-29,h3-28,h3-27
* Connected to httpbin.quic-corp.com <span style=color:#ff79c6>()</span> port <span style=color:#bd93f9>443</span> <span style=color:#ff79c6>(</span><span style=color:#6272a4>#0)</span>
* h3 <span style=color:#ff79c6>[</span>:method: GET<span style=color:#ff79c6>]</span>
* h3 <span style=color:#ff79c6>[</span>:path: /headers<span style=color:#ff79c6>]</span>
* h3 <span style=color:#ff79c6>[</span>:scheme: https<span style=color:#ff79c6>]</span>
* h3 <span style=color:#ff79c6>[</span>:authority: httpbin.quic-corp.com<span style=color:#ff79c6>]</span>
* h3 <span style=color:#ff79c6>[</span>user-agent: curl/7.78.0-DEV<span style=color:#ff79c6>]</span>
* h3 <span style=color:#ff79c6>[</span>accept: */*<span style=color:#ff79c6>]</span>
<span style=display:block;width:100%;background-color:#3d3f4a>* Using HTTP/3 Stream ID: <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>(</span>easy handle 0xa64260<span style=color:#ff79c6>)</span>
</span><span style=display:block;width:100%;background-color:#3d3f4a>&gt; GET /headers HTTP/3
</span>&gt; Host: httpbin.quic-corp.com
&gt; user-agent: curl/7.78.0-DEV
&gt; accept: */*
&gt; 
<span style=display:block;width:100%;background-color:#3d3f4a>&lt; HTTP/3 <span style=color:#bd93f9>200</span>
</span>&lt; server: istio-envoy
&lt; date: Wed, <span style=color:#bd93f9>27</span> Oct <span style=color:#bd93f9>2021</span> 05:08:46 GMT
&lt; content-type: application/json
&lt; content-length: <span style=color:#bd93f9>642</span>
&lt; access-control-allow-origin: *
&lt; access-control-allow-credentials: <span style=color:#8be9fd;font-style:italic>true</span>
&lt; x-envoy-upstream-service-time: <span style=color:#bd93f9>2</span>
&lt; alt-svc: <span style=color:#8be9fd;font-style:italic>h3</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;:443&#34;</span>; <span style=color:#8be9fd;font-style:italic>ma</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>86400</span>
&lt; 
<span style=color:#ff79c6>{</span>
  <span style=color:#f1fa8c>&#34;headers&#34;</span>: <span style=color:#ff79c6>{</span>
    <span style=color:#f1fa8c>&#34;Accept&#34;</span>: <span style=color:#f1fa8c>&#34;*/*&#34;</span>, 
    <span style=color:#f1fa8c>&#34;Host&#34;</span>: <span style=color:#f1fa8c>&#34;httpbin.quic-corp.com&#34;</span>, 
    <span style=color:#f1fa8c>&#34;Transfer-Encoding&#34;</span>: <span style=color:#f1fa8c>&#34;chunked&#34;</span>, 
    <span style=color:#f1fa8c>&#34;User-Agent&#34;</span>: <span style=color:#f1fa8c>&#34;curl/7.78.0-DEV&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Parentspanid&#34;</span>: <span style=color:#f1fa8c>&#34;d9f3d78e3f6ddc5c&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Sampled&#34;</span>: <span style=color:#f1fa8c>&#34;0&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Spanid&#34;</span>: <span style=color:#f1fa8c>&#34;3f6c920b02a92b73&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-B3-Traceid&#34;</span>: <span style=color:#f1fa8c>&#34;d5c22cd31ddec119d9f3d78e3f6ddc5c&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Envoy-Attempt-Count&#34;</span>: <span style=color:#f1fa8c>&#34;1&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Envoy-Internal&#34;</span>: <span style=color:#f1fa8c>&#34;true&#34;</span>, 
    <span style=color:#f1fa8c>&#34;X-Forwarded-Client-Cert&#34;</span>: <span style=color:#f1fa8c>&#34;By=spiffe://cluster.local/ns/httpbin/sa/httpbin;Hash=97bf9c90d4a5b9bb8f5da3e825dfa34f04631400420649394741807a320aa0a1;Subject=\&#34;\&#34;;URI=spiffe://cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account&#34;</span>
  <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span></code></pre></td></tr></table>
</div>
</div>
And&mldr;.. <strong>IT WORKS!</strong></p>
<div class=blog-tags>
<a href=https://su225.github.io//tags/istio/>istio</a>&nbsp;
<a href=https://su225.github.io//tags/quic/>quic</a>&nbsp;
</div>
</article>
<ul class="pager blog-pager">
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=https://github.com/su225 title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/suchithjn title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
Suchith J N
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://su225.github.io/>Tech notes</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.91.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://su225.github.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://su225.github.io/js/load-photoswipe.js></script>
</body>
</html>